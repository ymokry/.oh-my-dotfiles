#!/usr/bin/env sh

# Exit on any error
set -e

OMD_REPO_NAME=".oh-my-dotfiles"
OMD="$HOME/$OMD_REPO_NAME"

# Include shared helpers
source $OMD/_utils/shared.sh
source $OMD/_utils/setup.sh
source $OMD/_utils/stow.sh

# Run setup on first installation
if check_setup_flag; then
    OMD_SETUP_SCRIPT="$OMD/_setup/$(get_host).sh"

    if [ -f "$OMD_SETUP_SCRIPT" ]; then
        source $OMD_SETUP_SCRIPT
    fi

    create_setup_flag
fi

# Make sure all submodules
# are pulled and updated
git submodule init
git submodule update

# List of directories to be synced
# with all users, including root
base=(
    zsh
)

# Local user
user=(
    ssh
    git
)

# GUI app configs
gui=(
    ghostty
)

say "Linking configs for '$USER'"

for base_item in ${base[@]}; do
    link_config $HOME $base_item
done

if ! is_root_user; then
    for uset_item in ${user[@]}; do
        link_config $HOME $uset_item
    done

    if is_gui_env; then
        for gui_item in ${gui[@]}; do
            link_config $HOME $gui_item
        done
    fi
fi

say "Done"
